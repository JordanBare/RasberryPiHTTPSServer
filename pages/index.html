<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="Jordan Bare">
    <meta name="keywords" content="encryption, Boost Asio">
    <meta name="description" content="">
    <title>Black Sun</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <style>
        .textcol{color:#7E8889}
        .cenbackcol{background-color:#142634}
        .center{margin:0 auto;width:80%}
        nav ul{list-style-type:none;margin:0;padding:0;overflow:hidden}
        nav li a{display:block;color:white;text-align:center;padding:14px 16px;text-decoration:none}
        nav li a:hover{background-color:#111}
        article{padding:14px}

        button{display:inline-block;text-align:center;text-decoration:none}
        table{table-layout:fixed;width:100%}
        td button{background-color:#4CAF50;border-radius:4px;width:100%;padding:16px}
        td button:hover{background-color:#111;color:#CC7832}
        td{width:33%}
    </style>
    <script>
        window.onload = function(){
            let xhttp = new XMLHttpRequest();
            receiveBlog(xhttp);
            sendRequest(xhttp,"/recentblog");
        };
        function sendRequest(xhttp,resource){
            xhttp.open("GET", resource, true);
            xhttp.send();
        }
        function loadPage(resource){
            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function(){
                if(xhttp.readyState === 4 && xhttp.status === 200){
                    document.getElementById("content").innerHTML = this.responseText;
                }};
            sendRequest(xhttp,resource);
        }
        function notZero(blogId){
            return blogId !== 0;
        }
        function receiveBlog(xhttp){
            xhttp.onreadystatechange = function(){
                if (xhttp.readyState === 4 && xhttp.status === 200){
                    const blog = JSON.parse(this.responseText).value0;
                    let formattedBlog = "<article><h2>" + blog.value0 + "</h2><h3>" + blog.value1 + "</h3><p>" + blog.value2 + "</p></article>";
                    if (notZero(blog.value3)){
                        formattedBlog += formatBlogButton(blog.value3,"Previous");
                    }
                    if (notZero(blog.value4)){
                        formattedBlog += formatBlogButton(blog.value4,"Next");
                    }
                    document.getElementById("content").innerHTML = formattedBlog;
                }
            };
        }
        function formatBlogButton(blogId, name){
            return "<button onclick=\"loadBlog(\'" + blogId + "\')\">" + name + "</button>";
        }
        function loadBlog(blogToRequest){
            if(notZero(blogToRequest)){
                let xhttp = new XMLHttpRequest();
                receiveBlog(xhttp);
                sendRequest(xhttp,blogToRequest);
            }
        }
        function loadBlogIndex(){
            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function(){
                if (xhttp.readyState === 4 && xhttp.status === 200){
                    const blogArray = JSON.parse(this.responseText).value0;
                    const blogArrayLength = blogArray.length;
                    let formattedIndex = "<br><table>";
                    let count = 1;
                    formattedIndex += "<tr>";
                    blogArray.forEach(function(element){
                        formattedIndex += "<td>";
                        formattedIndex += formatBlogButton(element.key,element.value);
                        formattedIndex += "</td>";
                        if(count % 3 === 0 && count !== blogArrayLength){
                            formattedIndex += "</tr>";
                            formattedIndex += "<tr>";
                        }
                        count++;
                    });
                    formattedIndex += "</tr></table>";
                    document.getElementById("content").innerHTML = formattedIndex;
                }
            };
            sendRequest(xhttp,"/blogs")
        }
    </script>
</head>
<body style="background-color:#333">
<div>
    <div class="center cenbackcol">
        <nav>
            <ul>
                <li style="float:left"><a href="#" onclick="loadBlog('/recentblog')">Jordan Bare - Developer</a></li>
                <li style="float:right"><a href="#" onclick="loadBlogIndex()">Blogs</a></li>
                <li style="float:right"><a href="#" onclick="loadPage('/about')">About</a></li>
            </ul>
        </nav>
        <div id="content" class="textcol"></div>
        <footer></footer>
    </div>
</div>
</body>
</html>